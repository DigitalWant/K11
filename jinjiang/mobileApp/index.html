<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Demo</title>
	<link rel="shortcut icon" href="favicon.ico">
	<link rel="stylesheet" href="css/jquery.mobile-1.4.5.css">
	<link rel="stylesheet" href="css/main.css">
	<script src="js/jquery.js"></script>
	<script src="js/jquery.mobile-1.4.5.min.js"></script>
	<script src="js/wechat.js"></script>
	<script src="js/jquery.cookie.js"></script><!---->
	<script src="js/jquery.transit.min.js"></script><!---->
</head>
<body>


<!-- Start of main page -->
<div data-role="page" id="main">
	<div role="main" class="ui-content">
		<a id="start" href="#form"><img src="img/enterBtn.png" id="enter" /></a>
	</div><!-- /content -->
</div><!-- /page -->


<!-- Start of pop page: #popup -->
<div data-role="page" id="form">
	<div data-role="header"><img src="img/logo.png" id="logo" /></div>
	<div role="main" class="ui-content fieldset">	
		<p><input type="text" name="text-basic" id="phone" value="" placeholder="电话号码"></p> 
		<p><input type="text" name="text-basic" id="age" value="" placeholder="年龄"></p>
		    <select  id="gender">
		     	<option value="" disabled selected>性别</option>
			    <option value="male">男</option>
			    <option value="female">女</option>
		    </select>
			<a href="#intro" id="dataSubmit" class="ui-btn ui-shadow ui-corner-all ui-btn-inline ">拿我的钥匙</a>
		</div>		
	</div><!-- /content -->
</div><!-- /page popup -->



<!-- Start of intro page -->
<div data-role="page" id="intro">
	<div role="main" class="ui-content" style="height:100%;">
		<img src="img/intro.png" class="beginning not-animate" />
		<ul data-role="listview" style="height:100%;" ><!--
		--><li style="height:25%;"><a href="#hotelInfo1" data-transition="flip">
		<img src="img/hotel/hotel-1.png" />
		<img src="img/hotel/hotel-1.png" class="door"/>
		<img src="img/key.png" class="key not-animate" />
		<img src="img/lock.png" class="lock" />
		</a></li><!-- 
		--><li style="height:25%;"><a href="#hotelInfo2" data-transition="flip">
		<img src="img/hotel/hotel-2.png" />
		<img src="img/hotel/hotel-2.png" class="door"/>
		<img src="img/key.png" class="key not-animate" />
		<img src="img/lock.png" class="lock" />
		</a></li><!-- 
		--><li style="height:25%;"><a href="#hotelInfo3" data-transition="flip">
		<img src="img/hotel/hotel-3.png" />
		<img src="img/hotel/hotel-3.png" class="door"/>
		<img src="img/key.png" class="key not-animate" />
		<img src="img/lock.png" class="lock" />
		</a></li><!-- 
		--><li style="height:25%;"><a href="#hotelInfo4" data-transition="flip">
		<img src="img/hotel/hotel-4.png" />
		<img src="img/hotel/hotel-4.png" class="door"/>
		<img src="img/key.png" class="key not-animate" />
		<img src="img/lock.png" class="lock" />
		</a></li><!--
		--></ul>
	</div><!-- /content -->
	
</div><!-- /page -->




<!-- Start of hotelInfo  -->
<div data-role="page" id="hotelInfo1" >
	<div role="main" class="ui-content">
		<a href="#dishInfo1"><img src="http://placehold.it/320x480&amp;text=hotelInfo1" /></a>
	</div><!-- /content -->
</div>

<!-- Start of dishInfo  -->
<div data-role="page" id="dishInfo1" >
	<div role="main" class="ui-content">
		<a href="#intro" class="backToIntro"><img src="http://placehold.it/320x480&amp;text=dishInfo1" /></a>		
	</div><!-- /content -->
</div>






<!-- Start of hotelInfo  -->
<div data-role="page" id="hotelInfo2" >
	<div role="main" class="ui-content">
		<a href="#dishInfo2"><img src="http://placehold.it/320x480&amp;text=hotelInfo2" /></a>
	</div><!-- /content -->
</div>

<!-- Start of dishInfo  -->
<div data-role="page" id="dishInfo2" >
	<div role="main" class="ui-content">
		<a href="#intro" class="backToIntro" ><img src="http://placehold.it/320x480&amp;text=dishInfo2" /></a>
	</div><!-- /content -->
</div>






<!-- Start of hotelInfo  -->
<div data-role="page" id="hotelInfo3" >
	<div role="main" class="ui-content">
		<a href="#dishInfo3"><img src="http://placehold.it/320x480&amp;text=hotelInfo3" /></a>
	</div><!-- /content -->
</div>

<!-- Start of dishInfo  -->
<div data-role="page" id="dishInfo3" >
	<div role="main" class="ui-content">
		<a href="#intro" class="backToIntro"><img src="http://placehold.it/320x480&amp;text=dishInfo3" /></a>
	</div><!-- /content -->
</div>





<!-- Start of hotelInfo  -->
<div data-role="page" id="hotelInfo4" >
	<div role="main" class="ui-content">
		<a href="#dishInfo4"><img src="http://placehold.it/320x480&amp;text=hotelInfo4" /></a>
	</div><!-- /content -->
</div>

<!-- Start of dishInfo  -->
<div data-role="page" id="dishInfo4" >
	<div role="main" class="ui-content">
		<a href="#keyPage"><img src="http://placehold.it/320x680&amp;text=done" /></a>
	</div><!-- /content -->
</div>



<!-- Start of dishInfo  -->
<div data-role="page" id="keyPage" >
	<div role="main" class="ui-content">
		<a href="#"><img src="http://placehold.it/320x380&amp;text=Gold+Key" /></a>
		<a href="#"><img src="http://placehold.it/320x380&amp;text=Silver+Key" /></a>
	</div><!-- /content -->
</div>


<a href="#rule" id="ruleTip" class="ui-panel-animate" >游戏规则</a>

<!-- leftpanel3  -->
<div data-role="panel" id="rule" data-position="left" data-display="overlay" data-position-fixed="true" >
	 <h3>Left Panel: Overlay</h3>
    <p>This panel is positioned on the left with the overlay display mode. The panel markup is <em>after</em> the header, content and footer in the source order.</p>
    <p>To close, click off the panel, swipe left or right, hit the Esc key, or use the button below:</p>

</div><!-- /leftpanel3 -->



<script type="text/javascript" >

			//rule tips 
			var steps = [true,false,false,false];
			var $rulePanel = $( "body>[data-role='panel']" ).panel();
			var $ruleTips = $("#ruleTip");
			var $listKey = $("#intro [data-role=listview] A");
			var $backToIntro = $(".backToIntro");
			var $everyStepKeyImg = $("#intro img.key");
			var $beginning =$("#intro .beginning");
			var formData = {
				phone:"",
				age:"",
				gender:""
			};
			var $formSubmitBtn = $("#dataSubmit");

			$.cookie.json = true;

			var hasBeenShared = false;
			var midnight_cookie = function(name, value, path) {
			  var now = new Date();
			  var expire = new Date();
			  expire.setFullYear(now.getFullYear());
			  expire.setMonth(now.getMonth());
			  expire.setDate(now.getDate()+1);
			  expire.setHours(0);
			  expire.setMinutes(0);
			  document.cookie = name+"="+JSON.stringify(value)+"; expires=" + expire.toString() +"; path=" + path;
			  //return expire;
			}



			$formSubmitBtn.on('click',function(){
				$.removeCookie('formData');
				$.cookie('formData',formData,{expires:7,path:'/'});
			});



			// Bind an event to window.orientationchange that, when the device is turned,
			// gets the orientation and displays it to on screen.
			$( window ).on( "orientationchange", function( event ) {
				console.log("This device is in " + event.orientation + " mode!" );
			  //$( "#popup" ).text( "This device is in " + event.orientation + " mode!" );
			});
			 
			// You can also manually force this event to fire.
			$( window ).orientationchange();

			$rulePanel.on('panelbeforeopen',function(){
				$ruleTips.addClass('open');
			})
			$rulePanel.on('panelbeforeclose',function(){
				$ruleTips.removeClass('open');
			})

			// When entering intro
			$(document).on("pagebeforeshow","#intro",function(){ 

				if ($.cookie('gameStatus')){

					steps = $.cookie('gameStatus');
					
				}
				for( i in steps){
					if (steps[i] == true){

						$listKey.eq(i).addClass('unlocked');
					} 
				}


			});
			
			$(document).on("pageshow","#intro",function(){ 
				if ($.cookie('gameStatus')){

					steps = $.cookie('gameStatus');

				}
				if($beginning.hasClass('not-animate')){

					$beginning.transition({ 
								opacity: 1,
								  duration: 2200 
							 }).transition({
	  							rotateY: '360deg',
								  delay: 500
							}).transition({
								y: -100,
								opacity:0,
								duration: 2200,
								delay: 1000
 
							},function(){
								  	$beginning.remove();
							});
				}
				for( i in steps){

					if (steps[i] == true){				
						//if the key hasn't animate
						if($everyStepKeyImg.eq(i).hasClass('not-animate')){
							
							$everyStepKeyImg.eq(i)
							.transition({ 
								opacity: 1,
								  delay: 500
							 })
							.transition({
	  							rotateX: '360deg',
							}).removeClass('not-animate');
						}
					
					} 
				}					

			});

			//Reach the step end, mark on global
			$backToIntro.on('click',function(){

				var Index = $backToIntro.index($(this));
				steps[Index+1] = true;
				midnight_cookie('gameStatus',steps,'/');

			});
	

			//key list
			$listKey.on('click',function(e){
					var $thisLink =$(this);
					var $thisDoor =$('.door',$thisLink);

					if (!$thisLink.hasClass('unlocked')){
						e.preventDefault();	
					}
			})

			//$.cookie('gameStatus',steps);

			// 开发阶段，开启WeixinApi的调试模式
			//WeixinApi.enableDebugMode();

			// 初始化WeixinApi，等待分享
			WeixinApi.ready(function(Api) {

			    // 微信分享的数据
			    var wxData = {
			        "appId": "", // 服务号可以填写appId
			        "imgUrl" : 'img/logo.png',
			        "link" : "iamike.github.io/jinjiang/mobileApp",
			        "desc" : 'test',
			        "title" : "文章分享测试"
			    };

			    // 分享的回调
			    var wxCallbacks = {
			        // 收藏操作不执行回调，默认是开启(true)的
			        favorite : false,

			        // 分享操作开始之前
			        ready : function() {
			            // 你可以在这里对分享的数据进行重组
			            alert("准备分享");
			        },
			        // 分享被用户自动取消
			        cancel : function(resp) {
			            // 你可以在你的页面上给用户一个小Tip，为什么要取消呢？
			            alert("分享被取消，msg=" + resp.err_msg);
			        },
			        // 分享失败了
			        fail : function(resp) {
			            // 分享失败了，是不是可以告诉用户：不要紧，可能是网络问题，一会儿再试试？
			            alert("分享失败，msg=" + resp.err_msg);
			        },
			        // 分享成功
			        confirm : function(resp) {
			            // 分享成功了，我们是不是可以做一些分享统计呢？
			            alert("分享成功，msg=" + resp.err_msg);

			            hasBeenShared=true;
			        },
			        // 整个分享过程结束
			        all : function(resp,shareTo) {
			            // 如果你做的是一个鼓励用户进行分享的产品，在这里是不是可以给用户一些反馈了？
			            alert("分享" + (shareTo ? "到" + shareTo : "") + "结束，msg=" + resp.err_msg);
			        }
			    };

			    // 用户点开右上角popup菜单后，点击分享给好友，会执行下面这个代码
			    Api.shareToFriend(wxData, wxCallbacks);

			    // 点击分享到朋友圈，会执行下面这个代码
			    Api.shareToTimeline(wxData, wxCallbacks);

			    // 点击分享到腾讯微博，会执行下面这个代码
			    Api.shareToWeibo(wxData, wxCallbacks);

			    // iOS上，可以直接调用这个API进行分享，一句话搞定
			    Api.generalShare(wxData,wxCallbacks);
			});

	
</script>
</body>
</html>